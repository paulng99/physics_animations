<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diffraction Grating Simulation</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add MathJax configuration and script -->
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']]
          },
          svg: {
            fontCache: 'global'
          }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script"></script>
    <style>
        :root { color-scheme: light; }
        .glass { background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(10px); }
        /* Use Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for sliders */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #d1d5db; /* gray-300 */
            outline: none;
            opacity: 0.9;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2563eb; /* blue-600 */
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* Loading spinner */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #2563eb; /* blue-600 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        canvas {
            image-rendering: pixelated;
        }
        
        /* Fix MathJax layout */
        mjx-container {
            display: inline-block !important;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 text-slate-800">
    
    <!-- Header -->
    <header class="max-w-6xl mx-auto px-6 pt-6 pb-4">
        <nav class="flex items-center justify-between">
            <a href="index.html" class="inline-flex items-center gap-2 text-slate-600 hover:text-blue-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                <span class="font-medium" data-i18n="nav.back">Back to Home</span>
            </a>
            
            <!-- Language Switcher -->
            <div class="flex gap-2">
                <button onclick="setLanguage('zh')" class="lang-btn px-3 py-1 rounded-lg text-sm font-medium transition hover:bg-blue-100" data-lang="zh">繁</button>
                <button onclick="setLanguage('cn')" class="lang-btn px-3 py-1 rounded-lg text-sm font-medium transition hover:bg-blue-100" data-lang="cn">简</button>
                <button onclick="setLanguage('en')" class="lang-btn px-3 py-1 rounded-lg text-sm font-medium transition hover:bg-blue-100 bg-blue-600 text-white" data-lang="en">EN</button>
            </div>
        </nav>
    </header>

    <div class="w-full max-w-5xl mx-auto px-6 pb-16">
        <div class="glass rounded-3xl p-6 md:p-8 border border-white/60 space-y-8">
        
        <!-- Title -->
        <h1 class="text-2xl md:text-3xl font-bold text-center text-slate-800" data-i18n="title">
            Diffraction Grating
        </h1>

        <!-- Main Visualization Area -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Left Column: Schematic & Controls -->
            <div class="space-y-6">
                
                <!-- Schematic -->
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 relative h-64 flex flex-col items-center justify-center overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-10">
                        <!-- Background Grid -->
                        <div class="w-full h-full" style="background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px;"></div>
                    </div>
                    
                    <!-- Simplified Top-Down View -->
                    <div class="flex items-center w-full max-w-sm justify-between relative z-10">
                        <!-- Light Source -->
                        <div class="flex flex-col items-center gap-2">
                            <div class="w-4 h-4 rounded-full bg-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.6)]"></div>
                            <span class="text-xs text-slate-500 font-medium">Source</span>
                        </div>
                        
                        <!-- Rays -->
                        <div class="flex-1 h-32 relative mx-4">
                            <!-- Incident Rays -->
                            <div class="absolute top-1/2 left-0 w-1/2 h-0.5 -translate-y-1/2" id="incident-ray" style="background-color: #ef4444;"></div>
                            
                            <!-- Grating Element -->
                            <div class="absolute top-1/2 left-1/2 w-1 h-16 bg-slate-800 -translate-x-1/2 -translate-y-1/2 rounded-full flex flex-col justify-evenly">
                                <div class="w-full h-px bg-white/50"></div>
                                <div class="w-full h-px bg-white/50"></div>
                                <div class="w-full h-px bg-white/50"></div>
                            </div>
                            
                            <!-- Diffracted Rays (Fan out) -->
                            <div id="diffracted-rays" class="absolute top-1/2 left-1/2 w-1/2 h-full -translate-y-1/2 pointer-events-none">
                                <!-- Dynamic rays will be injected here via JS -->
                            </div>
                        </div>
                        
                        <!-- Screen -->
                        <div class="w-2 h-32 bg-slate-300 rounded shadow-inner flex flex-col items-center justify-center">
                            <!-- Screen -->
                        </div>
                    </div>
                    
                    <div class="absolute bottom-2 right-4 text-xs text-slate-400">
                        Top-down View (Not to Scale)
                    </div>
                </div>

                <!-- Controls -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-6">
                    <h3 class="font-semibold text-slate-700 border-b pb-2" data-i18n="controls.title">Parameters</h3>
                    
                    <!-- Wavelength -->
                    <div>
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-2">
                            <span data-i18n="controls.wavelength">Wavelength ($\lambda$)</span>
                            <span id="lambda-val" class="text-blue-600 font-bold font-mono">650 nm</span>
                        </label>
                        <input type="range" id="lambda-slider" min="400" max="700" value="650" class="w-full">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>400 nm (Violet)</span>
                            <span>700 nm (Red)</span>
                        </div>
                    </div>

                    <!-- Slit Spacing (d) -->
                    <div>
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-2">
                            <span data-i18n="controls.spacing">Grating Spacing ($d$)</span>
                            <span id="d-val" class="text-blue-600 font-bold font-mono">2.00 μm</span>
                        </label>
                        <input type="range" id="d-slider" min="1.0" max="5.0" step="0.05" value="2.0" class="w-full">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>1.0 μm (Dense)</span>
                            <span>5.0 μm (Sparse)</span>
                        </div>
                        <p class="text-xs text-slate-500 mt-2">
                            <span data-i18n="controls.lines">Lines per mm:</span> <span id="lines-per-mm" class="font-mono font-bold">500</span>
                        </p>
                    </div>

                    <!-- Number of Slits (N) - For Intensity Profile -->
                    <div>
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-2">
                            <span data-i18n="controls.N">Number of Slits ($N$)</span>
                            <span id="N-val" class="text-blue-600 font-bold font-mono">10</span>
                        </label>
                        <input type="range" id="N-slider" min="2" max="50" step="1" value="10" class="w-full">
                        <div class="text-xs text-slate-500 mt-1" data-i18n="controls.N_hint">Affects sharpness of maxima.</div>
                    </div>
                </div>

            </div>

            <!-- Right Column: Screen & Graph -->
            <div class="space-y-6">
                
                <!-- Screen Visualization -->
                <div class="bg-black rounded-xl p-1 shadow-lg border-4 border-slate-800">
                    <div class="relative w-full h-32 bg-black overflow-hidden rounded-lg">
                        <canvas id="screen-canvas" class="w-full h-full"></canvas>
                        <!-- Scale Overlay -->
                        <div class="absolute bottom-0 left-0 w-full h-6 border-t border-white/30 flex justify-between px-2 text-[10px] text-white/50 font-mono">
                            <span>-90°</span>
                            <span>-45°</span>
                            <span>0°</span>
                            <span>+45°</span>
                            <span>+90°</span>
                        </div>
                    </div>
                    <div class="text-center text-slate-400 text-xs py-2 uppercase tracking-widest font-bold">
                        <span data-i18n="screen.view">Diffraction Pattern (Angle $\theta$)</span>
                    </div>
                </div>

                <!-- Intensity Graph -->
                <div class="bg-white p-4 rounded-xl border border-slate-200 h-64 relative">
                    <h3 class="text-sm font-bold text-slate-500 absolute top-4 left-4" data-i18n="graph.title">Intensity Profile</h3>
                    <canvas id="graph-canvas" class="w-full h-full"></canvas>
                </div>

                <!-- Physics Formula Card -->
                <div class="bg-slate-900 text-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3" data-i18n="formula.title">Grating Equation</h3>
                    <div class="text-center text-xl font-serif mb-4">
                        $$ d \sin \theta = n \lambda $$
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm text-slate-300">
                        <div>
                            <span class="text-blue-400 font-bold">$d$:</span> <span data-i18n="formula.d">Slit spacing</span>
                        </div>
                        <div>
                            <span class="text-blue-400 font-bold">$\theta$:</span> <span data-i18n="formula.theta">Diffraction angle</span>
                        </div>
                        <div>
                            <span class="text-blue-400 font-bold">$n$:</span> <span data-i18n="formula.n">Order (0, 1, 2...)</span>
                        </div>
                        <div>
                            <span class="text-blue-400 font-bold">$\lambda$:</span> <span data-i18n="formula.lambda">Wavelength</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- AI Explanation -->
        <div class="mt-8 bg-blue-50 p-6 rounded-2xl border border-blue-100">
            <div class="flex items-start gap-4">
                <div class="p-3 bg-blue-600 rounded-xl text-white">
                    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-slate-800 mb-2" data-i18n="ai.title">AI Physics Tutor</h3>
                    <p class="text-slate-600 text-sm mb-4" data-i18n="ai.desc">
                        Ask the AI to explain why increasing the number of slits ($N$) makes the maxima sharper and brighter.
                    </p>
                    <button id="explain-button" class="px-5 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition shadow-sm flex items-center gap-2">
                        <span>✨</span> <span data-i18n="ai.btn">Explain Intensity Profile</span>
                    </button>
                    
                    <div id="gemini-loading" class="hidden mt-4 flex items-center text-sm text-blue-600">
                        <div class="spinner mr-2"></div> Generating explanation...
                    </div>
                    <div id="gemini-explanation" class="hidden mt-4 text-sm text-slate-700 leading-relaxed prose prose-blue max-w-none bg-white p-4 rounded-lg border border-blue-100"></div>
                </div>
            </div>
        </div>

    </div>
    </div>

    <!-- Script Logic -->
    <script>
        // DOM Elements
        const lambdaSlider = document.getElementById('lambda-slider');
        const dSlider = document.getElementById('d-slider');
        const NSlider = document.getElementById('N-slider');
        
        const lambdaVal = document.getElementById('lambda-val');
        const dVal = document.getElementById('d-val');
        const NVal = document.getElementById('N-val');
        const linesPerMm = document.getElementById('lines-per-mm');
        
        const screenCanvas = document.getElementById('screen-canvas');
        const graphCanvas = document.getElementById('graph-canvas');
        
        const incidentRay = document.getElementById('incident-ray');
        const diffractedRaysContainer = document.getElementById('diffracted-rays');

        // State
        const state = {
            lambda: 650, // nm
            d: 2.0,      // um
            N: 10        // Slits
        };

        // Helpers
        function wavelengthToColor(lambda) {
            let r, g, b;
            if (lambda >= 380 && lambda < 440) {
                r = -1 * (lambda - 440) / (440 - 380);
                g = 0;
                b = 1;
            } else if (lambda >= 440 && lambda < 490) {
                r = 0;
                g = (lambda - 440) / (490 - 440);
                b = 1;
            } else if (lambda >= 490 && lambda < 510) {
                r = 0;
                g = 1;
                b = -1 * (lambda - 510) / (510 - 490);
            } else if (lambda >= 510 && lambda < 580) {
                r = (lambda - 510) / (580 - 510);
                g = 1;
                b = 0;
            } else if (lambda >= 580 && lambda < 645) {
                r = 1;
                g = -1 * (lambda - 645) / (645 - 580);
                b = 0;
            } else if (lambda >= 645 && lambda <= 780) {
                r = 1;
                g = 0;
                b = 0;
            } else {
                r = 0; g = 0; b = 0;
            }
            return `rgb(${Math.floor(r * 255)}, ${Math.floor(g * 255)}, ${Math.floor(b * 255)})`;
        }

        // Main Update Loop
        function update() {
            // Read Inputs
            state.lambda = parseInt(lambdaSlider.value);
            state.d = parseFloat(dSlider.value);
            state.N = parseInt(NSlider.value);

            // Update Text
            lambdaVal.textContent = `${state.lambda} nm`;
            dVal.textContent = `${state.d.toFixed(2)} μm`;
            NVal.textContent = state.N;
            
            const lines = (1000 / state.d).toFixed(0);
            linesPerMm.textContent = lines;

            // Colors
            const color = wavelengthToColor(state.lambda);
            incidentRay.style.backgroundColor = color;

            // Physics Calculation: Maxima Angles
            // d * sin(theta) = n * lambda
            // sin(theta) = n * lambda / d
            // lambda in nm, d in um. Convert to same units.
            const lambda_um = state.lambda / 1000;
            const d_um = state.d;
            
            const maxima = [];
            // Find valid orders
            for (let n = 0; n < 10; n++) { // Check positive n
                const sinTheta = (n * lambda_um) / d_um;
                if (sinTheta <= 1) {
                    maxima.push({ n: n, theta: Math.asin(sinTheta) });
                    if (n > 0) maxima.push({ n: -n, theta: Math.asin(-sinTheta) });
                } else {
                    break; 
                }
            }

            // Draw Schematic Rays
            diffractedRaysContainer.innerHTML = '';
            maxima.forEach(m => {
                // Only draw low orders to avoid clutter
                if (Math.abs(m.n) > 2) return;
                
                const ray = document.createElement('div');
                ray.className = 'absolute top-1/2 left-0 h-0.5 origin-left opacity-60';
                ray.style.backgroundColor = color;
                ray.style.width = '150%'; // Extend past container
                // Rotate. theta is in radians. 
                // Schematic is top-down. 0 deg is right (0 rad).
                // Rotation in CSS is clockwise positive.
                // Physics theta: Counter-clockwise is positive? Usually.
                // Let's assume standard math notation: CCW positive. CSS rotate is CW.
                // So rotate by -theta.
                ray.style.transform = `translateY(-50%) rotate(${-m.theta}rad)`;
                diffractedRaysContainer.appendChild(ray);
            });

            // Draw Screen
            drawScreen(maxima, color);

            // Draw Graph
            drawGraph(lambda_um, d_um, state.N, color);
        }

        function drawScreen(maxima, color) {
            const ctx = screenCanvas.getContext('2d');
            const w = screenCanvas.width = screenCanvas.clientWidth * 2; // Retina
            const h = screenCanvas.height = screenCanvas.clientHeight * 2;
            
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, w, h);

            // Mapping: -90 deg to +90 deg maps to 0 to w
            // x = (sin(theta) + 1) / 2 * w ? Or linear with theta?
            // Usually screens are flat, so x = D * tan(theta).
            // But here we want to visualize the full 180 degree field of view (fisheye style) or just -90 to 90 mapped linearly.
            // Let's map Angle linearly to X for clarity.
            
            maxima.forEach(m => {
                // Map theta (-PI/2 to PI/2) to (0 to w)
                const x = ((m.theta / (Math.PI/2)) + 1) / 2 * w;
                
                // Draw a glowy line
                const gradient = ctx.createRadialGradient(x, h/2, 0, x, h/2, w/20);
                gradient.addColorStop(0, color);
                gradient.addColorStop(0.2, color.replace(')', ', 0.5)').replace('rgb', 'rgba'));
                gradient.addColorStop(1, 'transparent');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x - w/20, 0, w/10, h);
                
                // Core
                ctx.fillStyle = 'white';
                ctx.globalAlpha = 0.8;
                ctx.fillRect(x - 1, 10, 2, h-20);
                ctx.globalAlpha = 1.0;
                
                // Label order
                ctx.fillStyle = 'white';
                ctx.font = 'bold 20px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`n=${m.n}`, x, h - 10);
            });
        }

        function drawGraph(lambda, d, N, color) {
            const ctx = graphCanvas.getContext('2d');
            const w = graphCanvas.width = graphCanvas.clientWidth * 2;
            const h = graphCanvas.height = graphCanvas.clientHeight * 2;
            
            ctx.clearRect(0, 0, w, h);
            
            // Draw Axes
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, h - 20);
            ctx.lineTo(w, h - 20); // X Axis
            ctx.stroke();

            // Plot I = I0 * [sin(N * beta) / sin(beta)]^2
            // where beta = (pi * d * sin(theta)) / lambda
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();

            const samples = 1000;
            for (let i = 0; i <= samples; i++) {
                // x goes from 0 to w, representing theta -90 to +90
                const pct = i / samples;
                const theta = (pct * Math.PI) - (Math.PI / 2); // -PI/2 to PI/2
                
                const beta = (Math.PI * d * Math.sin(theta)) / lambda;
                
                let intensity;
                if (Math.abs(beta) < 1e-6) {
                    intensity = N * N; // Limit at 0 is N^2
                } else {
                    const val = Math.sin(N * beta) / Math.sin(beta);
                    intensity = val * val;
                }
                
                // Normalize intensity: Max is N^2
                const normI = intensity / (N * N);
                
                const px = i * (w / samples);
                const py = (h - 20) - (normI * (h - 40)); // Leave padding
                
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
            
            // Fill under curve
            ctx.lineTo(w, h - 20);
            ctx.lineTo(0, h - 20);
            ctx.fillStyle = color.replace(')', ', 0.1)').replace('rgb', 'rgba');
            ctx.fill();
        }

        // Listeners
        lambdaSlider.addEventListener('input', update);
        dSlider.addEventListener('input', update);
        NSlider.addEventListener('input', update);

        // Initial call
        update();

        // --- Gemini AI ---
        const explainBtn = document.getElementById('explain-button');
        const loading = document.getElementById('gemini-loading');
        const output = document.getElementById('gemini-explanation');

        async function callGeminiAPI(query) {
            // Mock response for now (or replace with real key logic if env is set)
            // In production, use backend proxy.
            const explanation = `
                <p class="mb-2"><strong>Intensity & Number of Slits ($N$):</strong></p>
                <p class="mb-2">When you increase the number of slits ($N$), two main things happen to the diffraction pattern:</p>
                <ul class="list-disc pl-5 mb-2">
                    <li><strong>Brighter Maxima:</strong> The intensity of the principal maxima increases as $N^2$. This is because the waves from all $N$ slits interfere constructively perfectly at these angles.</li>
                    <li><strong>Sharper Peaks:</strong> The width of the bright fringes decreases as $1/N$. This happens because even a small deviation from the perfect angle causes destructive interference between the many slits.</li>
                </ul>
                <p>This is why diffraction gratings (high $N$) produce much sharper spectral lines than a simple double-slit setup ($N=2$).</p>
            `;
            return new Promise(r => setTimeout(() => r(explanation), 1500));
        }

        explainBtn.addEventListener('click', async () => {
            explainBtn.disabled = true;
            explainBtn.classList.add('opacity-50');
            loading.classList.remove('hidden');
            output.classList.add('hidden');
            
            const text = await callGeminiAPI();
            output.innerHTML = text;
            
            loading.classList.add('hidden');
            output.classList.remove('hidden');
            explainBtn.disabled = false;
            explainBtn.classList.remove('opacity-50');
        });

        // --- Language ---
        const translations = {
            en: {
                'nav.back': 'Back to Home',
                'title': 'Diffraction Grating Simulator',
                'controls.title': 'Parameters',
                'controls.wavelength': 'Wavelength ($\\lambda$)',
                'controls.spacing': 'Grating Spacing ($d$)',
                'controls.lines': 'Lines per mm:',
                'controls.N': 'Number of Slits ($N$)',
                'controls.N_hint': 'Affects sharpness of maxima.',
                'screen.view': 'Diffraction Pattern (Angle $\\theta$)',
                'graph.title': 'Intensity Profile',
                'formula.title': 'Grating Equation',
                'formula.d': 'Slit spacing',
                'formula.theta': 'Diffraction angle',
                'formula.n': 'Order (0, 1, 2...)',
                'formula.lambda': 'Wavelength',
                'ai.title': 'AI Physics Tutor',
                'ai.desc': 'Ask the AI to explain why increasing the number of slits ($N$) makes the maxima sharper and brighter.',
                'ai.btn': 'Explain Intensity Profile'
            },
            zh: {
                'nav.back': '返回首頁',
                'title': '繞射光柵模擬',
                'controls.title': '參數設置',
                'controls.wavelength': '波長 ($\\lambda$)',
                'controls.spacing': '光柵間距 ($d$)',
                'controls.lines': '每毫米線數：',
                'controls.N': '狹縫數量 ($N$)',
                'controls.N_hint': '影響主極大值的銳度。',
                'screen.view': '繞射圖樣 (角度 $\\theta$)',
                'graph.title': '強度分佈',
                'formula.title': '光柵方程',
                'formula.d': '狹縫間距',
                'formula.theta': '繞射角',
                'formula.n': '級數 (0, 1, 2...)',
                'formula.lambda': '波長',
                'ai.title': 'AI 物理導師',
                'ai.desc': '詢問 AI 為什麼增加狹縫數量 ($N$) 會使極大值更銳利且更亮。',
                'ai.btn': '解釋強度分佈'
            },
            cn: {
                'nav.back': '返回首页',
                'title': '衍射光栅模拟',
                'controls.title': '参数设置',
                'controls.wavelength': '波长 ($\\lambda$)',
                'controls.spacing': '光栅间距 ($d$)',
                'controls.lines': '每毫米线数：',
                'controls.N': '狭缝数量 ($N$)',
                'controls.N_hint': '影响主极大值的锐度。',
                'screen.view': '衍射图样 (角度 $\\theta$)',
                'graph.title': '强度分布',
                'formula.title': '光栅方程',
                'formula.d': '狭缝间距',
                'formula.theta': '衍射角',
                'formula.n': '级数 (0, 1, 2...)',
                'formula.lambda': '波长',
                'ai.title': 'AI 物理导师',
                'ai.desc': '询问 AI 为什么增加狭缝数量 ($N$) 会使极大值更锐利且更亮。',
                'ai.btn': '解释强度分布'
            }
        };

        function setLanguage(lang) {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            if (window.MathJax) MathJax.typesetPromise();
        }
    </script>
</body>
</html>
