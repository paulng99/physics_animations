<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Young's Double-Slit Experiment</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add MathJax configuration and script -->
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']]
          },
          svg: {
            fontCache: 'global'
          }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script"></script>
    <style>
        :root { color-scheme: light; }
        .glass { background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(10px); }
        /* Use Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for sliders */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #d1d5db; /* gray-300 */
            outline: none;
            opacity: 0.9;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2563eb; /* blue-600 */
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* Loading spinner */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #2563eb; /* blue-600 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        canvas {
            image-rendering: pixelated;
        }

        /* Fix MathJax layout */
        mjx-container {
            display: inline-block !important;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 text-slate-800">
    
    <!-- Header -->
    <header class="max-w-6xl mx-auto px-6 pt-6 pb-4">
        <nav class="flex items-center justify-between">
            <a href="index.html" class="inline-flex items-center gap-2 text-slate-600 hover:text-blue-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                <span class="font-medium" data-i18n="nav.back">Back to Home</span>
            </a>
            
            <!-- Language Switcher -->
            <div class="flex gap-2">
                <button onclick="setLanguage('zh')" class="lang-btn px-3 py-1 rounded-lg text-sm font-medium transition hover:bg-blue-100" data-lang="zh">繁</button>
                <button onclick="setLanguage('cn')" class="lang-btn px-3 py-1 rounded-lg text-sm font-medium transition hover:bg-blue-100" data-lang="cn">简</button>
                <button onclick="setLanguage('en')" class="lang-btn px-3 py-1 rounded-lg text-sm font-medium transition hover:bg-blue-100 bg-blue-600 text-white" data-lang="en">EN</button>
            </div>
        </nav>
    </header>

    <div class="w-full max-w-5xl mx-auto px-6 pb-16">
        <div class="glass rounded-3xl p-6 md:p-8 border border-white/60 space-y-8">
        
        <!-- Title -->
        <h1 class="text-2xl md:text-3xl font-bold text-center text-slate-800" data-i18n="title">
            Young's Double-Slit Experiment
        </h1>

        <!-- Main Visualization Area -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Left Column: Schematic & Controls -->
            <div class="space-y-6">
                
                <!-- Schematic -->
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 relative h-64 flex flex-col items-center justify-center overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-10">
                        <!-- Background Grid -->
                        <div class="w-full h-full" style="background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px;"></div>
                    </div>
                    
                    <!-- Simplified Top-Down View -->
                    <div class="flex items-center w-full max-w-sm justify-between relative z-10">
                        <!-- Light Source -->
                        <div class="flex flex-col items-center gap-2">
                            <div class="w-4 h-4 rounded-full bg-red-600 shadow-[0_0_15px_rgba(239,68,68,0.6)]" id="source-dot"></div>
                            <span class="text-xs text-slate-500 font-medium">Laser</span>
                        </div>
                        
                        <!-- Rays -->
                        <div class="flex-1 h-32 relative mx-4">
                            <!-- Incident Rays -->
                            <div class="absolute top-1/2 left-0 w-1/2 h-0.5 -translate-y-1/2" id="incident-ray" style="background-color: #ef4444;"></div>
                            
                            <!-- Slit Barrier -->
                            <div class="absolute top-1/2 left-1/2 w-1 h-20 bg-slate-800 -translate-x-1/2 -translate-y-1/2 rounded-full">
                                <!-- Dynamic Slits -->
                                <div id="slit-gap-1" class="absolute left-0 w-full bg-white/80" style="height: 2px; top: 40%;"></div>
                                <div id="slit-gap-2" class="absolute left-0 w-full bg-white/80" style="height: 2px; top: 60%;"></div>
                            </div>
                            
                            <!-- Interference Area (Visual Only) -->
                            <div class="absolute top-1/2 left-1/2 w-1/2 h-full -translate-y-1/2 pointer-events-none overflow-hidden opacity-30">
                                <div class="w-full h-full" id="wave-visual" style="background: repeating-radial-gradient(circle at 0% 50%, transparent 0, transparent 4px, currentColor 5px, transparent 6px);"></div>
                            </div>
                        </div>
                        
                        <!-- Screen -->
                        <div class="w-2 h-32 bg-slate-300 rounded shadow-inner flex flex-col items-center justify-center">
                            <!-- Screen -->
                        </div>
                    </div>
                    
                    <div class="absolute bottom-2 right-4 text-xs text-slate-400">
                        Top-down View
                    </div>
                </div>

                <!-- Controls -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-6">
                    <h3 class="font-semibold text-slate-700 border-b pb-2" data-i18n="controls.title">Parameters</h3>
                    
                    <!-- Wavelength -->
                    <div>
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-2">
                            <span data-i18n="controls.wavelength">Wavelength ($\lambda$)</span>
                            <span id="lambda-val" class="text-blue-600 font-bold font-mono">650 nm</span>
                        </label>
                        <input type="range" id="lambda-slider" min="400" max="700" value="650" class="w-full">
                    </div>

                    <!-- Slit Separation (a) -->
                    <div>
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-2">
                            <span data-i18n="controls.slit">Slit Separation ($a$)</span>
                            <span id="a-val" class="text-blue-600 font-bold font-mono">0.40 mm</span>
                        </label>
                        <input type="range" id="a-slider" min="0.1" max="1.0" step="0.01" value="0.4" class="w-full">
                    </div>

                    <!-- Screen Distance (D) -->
                    <div>
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-2">
                            <span data-i18n="controls.distance">Screen Distance ($D$)</span>
                            <span id="D-val" class="text-blue-600 font-bold font-mono">1.40 m</span>
                        </label>
                        <input type="range" id="D-slider" min="1.0" max="3.0" step="0.01" value="1.4" class="w-full">
                    </div>
                </div>
                
                <!-- Data Panel -->
                <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 shadow-sm">
                    <h3 class="font-semibold text-slate-700 border-b pb-2 mb-4" data-i18n="data.title">Results</h3>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-slate-600" data-i18n="pattern.fringe">Fringe Separation ($\Delta y$)</span>
                        <span id="delta-y-val" class="text-2xl font-bold text-slate-800 font-mono">2.28 mm</span>
                    </div>
                </div>

            </div>

            <!-- Right Column: Screen & Graph -->
            <div class="space-y-6">
                
                <!-- Screen Visualization -->
                <div class="bg-black rounded-xl p-1 shadow-lg border-4 border-slate-800">
                    <div class="relative w-full h-32 bg-black overflow-hidden rounded-lg">
                        <canvas id="screen-canvas" class="w-full h-full"></canvas>
                        <!-- Scale Overlay -->
                        <div class="absolute bottom-0 left-0 w-full h-6 border-t border-white/30 flex justify-between px-2 text-[10px] text-white/50 font-mono">
                            <span>-20mm</span>
                            <span>-10mm</span>
                            <span>0</span>
                            <span>+10mm</span>
                            <span>+20mm</span>
                        </div>
                    </div>
                    <div class="text-center text-slate-400 text-xs py-2 uppercase tracking-widest font-bold">
                        <span data-i18n="pattern.title">Interference Pattern</span>
                    </div>
                </div>

                <!-- Intensity Graph -->
                <div class="bg-white p-4 rounded-xl border border-slate-200 h-64 relative">
                    <h3 class="text-sm font-bold text-slate-500 absolute top-4 left-4" data-i18n="graph.title">Intensity Profile</h3>
                    <canvas id="graph-canvas" class="w-full h-full"></canvas>
                </div>

                <!-- Physics Formula Card -->
                <div class="bg-slate-900 text-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3" data-i18n="explanation.text">Formula</h3>
                    <div class="text-center text-xl font-serif mb-4">
                        $$ \Delta y = \frac{\lambda D}{a} $$
                    </div>
                    <div class="text-center text-sm text-slate-300 font-serif">
                        $$ I = I_0 \cos^2\left(\frac{\pi a y}{\lambda D}\right) $$
                    </div>
                </div>

            </div>
        </div>

        <!-- AI Explanation -->
        <div class="mt-8 bg-blue-50 p-6 rounded-2xl border border-blue-100">
            <div class="flex items-start gap-4">
                <div class="p-3 bg-blue-600 rounded-xl text-white">
                    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-slate-800 mb-2" data-i18n="ai.title">AI Physics Tutor</h3>
                    <p class="text-slate-600 text-sm mb-4" data-i18n="explanation.question">
                        Try answering question (a)(i) from your sheet: How can you increase the average separation ($\Delta y$)?
                    </p>
                    <button id="explain-button" class="px-5 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition shadow-sm flex items-center gap-2">
                        <span>✨</span> <span data-i18n="button.explain">Explain This Concept</span>
                    </button>
                    
                    <div id="gemini-loading" class="hidden mt-4 flex items-center text-sm text-blue-600">
                        <div class="spinner mr-2"></div> Generating explanation...
                    </div>
                    <div id="gemini-explanation" class="hidden mt-4 text-sm text-slate-700 leading-relaxed prose prose-blue max-w-none bg-white p-4 rounded-lg border border-blue-100"></div>
                </div>
            </div>
        </div>

    </div>
    </div>

    <!-- Script Logic -->
    <script>
        // DOM Elements
        const lambdaSlider = document.getElementById('lambda-slider');
        const aSlider = document.getElementById('a-slider');
        const DSlider = document.getElementById('D-slider');
        
        const lambdaVal = document.getElementById('lambda-val');
        const aVal = document.getElementById('a-val');
        const DVal = document.getElementById('D-val');
        const deltaYVal = document.getElementById('delta-y-val');
        
        const screenCanvas = document.getElementById('screen-canvas');
        const graphCanvas = document.getElementById('graph-canvas');
        
        const incidentRay = document.getElementById('incident-ray');
        const sourceDot = document.getElementById('source-dot');
        const waveVisual = document.getElementById('wave-visual');
        const slitGap1 = document.getElementById('slit-gap-1');
        const slitGap2 = document.getElementById('slit-gap-2');

        // State
        const state = {
            lambda: 650, // nm
            a: 0.40,     // mm
            D: 1.40      // m
        };

        // Helpers
        function wavelengthToColor(lambda) {
            let r, g, b;
            if (lambda >= 380 && lambda < 440) {
                r = -1 * (lambda - 440) / (440 - 380);
                g = 0;
                b = 1;
            } else if (lambda >= 440 && lambda < 490) {
                r = 0;
                g = (lambda - 440) / (490 - 440);
                b = 1;
            } else if (lambda >= 490 && lambda < 510) {
                r = 0;
                g = 1;
                b = -1 * (lambda - 510) / (510 - 490);
            } else if (lambda >= 510 && lambda < 580) {
                r = (lambda - 510) / (580 - 510);
                g = 1;
                b = 0;
            } else if (lambda >= 580 && lambda < 645) {
                r = 1;
                g = -1 * (lambda - 645) / (645 - 580);
                b = 0;
            } else if (lambda >= 645 && lambda <= 780) {
                r = 1;
                g = 0;
                b = 0;
            } else {
                r = 0; g = 0; b = 0;
            }
            return `rgb(${Math.floor(r * 255)}, ${Math.floor(g * 255)}, ${Math.floor(b * 255)})`;
        }

        // Main Update Loop
        function update() {
            // Read Inputs
            state.lambda = parseInt(lambdaSlider.value);
            state.a = parseFloat(aSlider.value);
            state.D = parseFloat(DSlider.value);

            // Update Text
            lambdaVal.textContent = `${state.lambda} nm`;
            aVal.textContent = `${state.a.toFixed(2)} mm`;
            DVal.textContent = `${state.D.toFixed(2)} m`;

            // Physics Calc
            // Delta y = lambda * D / a
            const lambda_m = state.lambda * 1e-9;
            const a_m = state.a * 1e-3;
            const D_m = state.D;
            
            const deltaY_m = (lambda_m * D_m) / a_m;
            const deltaY_mm = deltaY_m * 1e3;
            
            deltaYVal.textContent = `${deltaY_mm.toFixed(2)} mm`;

            // Colors
            const color = wavelengthToColor(state.lambda);
            incidentRay.style.backgroundColor = color;
            sourceDot.style.backgroundColor = color;
            sourceDot.style.boxShadow = `0 0 15px ${color.replace(')', ', 0.6)').replace('rgb', 'rgba')}`;
            waveVisual.style.color = color;

            // Schematic Animation
            // Map 'a' (0.1 to 1.0) to gap positions
            const range = 1.0 - 0.1;
            const pct = (state.a - 0.1) / range; // 0 to 1
            const spread = 20 + pct * 40; // 20% to 60% spread
            
            slitGap1.style.top = `${50 - spread/2}%`;
            slitGap2.style.top = `${50 + spread/2}%`;

            // Draw Screen
            drawScreen(lambda_m, a_m, D_m, color);

            // Draw Graph
            drawGraph(lambda_m, a_m, D_m, color);
            
            // Re-render MathJax
            if (window.MathJax && window.MathJax.typesetPromise) {
                // Debounce or just call it? calling it rapidly might be slow.
                // For now, let's rely on manual re-render or assume it's static mostly.
            }
        }

        function drawScreen(lambda, a, D, color) {
            const ctx = screenCanvas.getContext('2d');
            const w = screenCanvas.width = screenCanvas.clientWidth * 2; 
            const h = screenCanvas.height = screenCanvas.clientHeight * 2;
            
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, w, h);

            // Screen represents +/- 20mm
            const screenRange_m = 0.02; // 20mm
            
            const pixelsPerMeter = (w / 2) / screenRange_m;

            const samples = w; 
            for (let i = 0; i < samples; i++) {
                const x_px = i;
                // Convert px to meter position (0 is center)
                const y_m = (x_px - w/2) / pixelsPerMeter;
                
                // Intensity I = I0 * cos^2( (pi * a * y) / (lambda * D) )
                const phase = (Math.PI * a * y_m) / (lambda * D);
                const intensity = Math.pow(Math.cos(phase), 2);
                
                // Draw vertical line with this alpha
                ctx.fillStyle = color.replace(')', `, ${intensity})`).replace('rgb', 'rgba');
                ctx.fillRect(x_px, 0, 1, h);
            }
        }

        function drawGraph(lambda, a, D, color) {
            const ctx = graphCanvas.getContext('2d');
            const w = graphCanvas.width = graphCanvas.clientWidth * 2;
            const h = graphCanvas.height = graphCanvas.clientHeight * 2;
            
            ctx.clearRect(0, 0, w, h);
            
            // Draw Axes
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, h - 20);
            ctx.lineTo(w, h - 20); // X Axis
            ctx.stroke();

            // Plot Intensity
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();

            const screenRange_m = 0.02; // Matches screen view (+/- 20mm)
            const pixelsPerMeter = (w / 2) / screenRange_m;

            const samples = 1000;
            for (let i = 0; i <= samples; i++) {
                const pct = i / samples;
                const px = pct * w;
                
                const y_m = (px - w/2) / pixelsPerMeter;
                const phase = (Math.PI * a * y_m) / (lambda * D);
                const intensity = Math.pow(Math.cos(phase), 2);
                
                const py = (h - 20) - (intensity * (h - 40));
                
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
            
            // Fill
            ctx.lineTo(w, h - 20);
            ctx.lineTo(0, h - 20);
            ctx.fillStyle = color.replace(')', ', 0.1)').replace('rgb', 'rgba');
            ctx.fill();
        }

        // Listeners
        lambdaSlider.addEventListener('input', update);
        aSlider.addEventListener('input', update);
        DSlider.addEventListener('input', update);

        // Initial call
        update();

        // --- Gemini AI ---
        const explainBtn = document.getElementById('explain-button');
        const loading = document.getElementById('gemini-loading');
        const output = document.getElementById('gemini-explanation');

        async function callGeminiAPI(query) {
             const explanation = `
                <p class="mb-2"><strong>Fringe Separation ($\Delta y$):</strong></p>
                <p class="mb-2">The formula is $\\Delta y = \\frac{\\lambda D}{a}$. Here's how each factor changes the pattern:</p>
                <ul class="list-disc pl-5 mb-2">
                    <li><strong>Wavelength ($\\lambda$):</strong> Increasing $\\lambda$ (redder light) increases $\\Delta y$. The waves are "bigger," so they spread out more.</li>
                    <li><strong>Distance ($D$):</strong> Increasing the screen distance $D$ increases $\\Delta y$. The pattern has more room to spread out.</li>
                    <li><strong>Slit Separation ($a$):</strong> Decreasing $a$ increases $\\Delta y$. Bringing slits closer together makes the interference pattern wider.</li>
                </ul>
            `;
            return new Promise(r => setTimeout(() => r(explanation), 1500));
        }

        explainBtn.addEventListener('click', async () => {
            explainBtn.disabled = true;
            explainBtn.classList.add('opacity-50');
            loading.classList.remove('hidden');
            output.classList.add('hidden');
            
            const text = await callGeminiAPI();
            output.innerHTML = text;
            
            loading.classList.add('hidden');
            output.classList.remove('hidden');
            explainBtn.disabled = false;
            explainBtn.classList.remove('opacity-50');
        });

        // --- Language ---
        const translations = {
            en: {
                'nav.back': 'Back to Home',
                'title': "Young's Double-Slit Experiment",
                'controls.title': 'Parameters',
                'controls.wavelength': 'Wavelength ($\\lambda$)',
                'controls.slit': 'Slit Separation ($a$)',
                'controls.distance': 'Screen Distance ($D$)',
                'pattern.title': 'Interference Pattern',
                'pattern.fringe': 'Fringe Separation ($\\Delta y$)',
                'graph.title': 'Intensity Profile',
                'explanation.text': 'Formula',
                'explanation.question': 'Try answering question (a)(i): How can you increase $\\Delta y$?',
                'button.explain': 'Explain This Concept',
                'data.title': 'Results',
                'ai.title': 'AI Physics Tutor'
            },
            zh: {
                'nav.back': '返回首頁',
                'title': '楊氏雙狹縫實驗',
                'controls.title': '參數設置',
                'controls.wavelength': '波長 ($\\lambda$)',
                'controls.slit': '狹縫間距 ($a$)',
                'controls.distance': '屏幕距離 ($D$)',
                'pattern.title': '干涉圖樣',
                'pattern.fringe': '條紋間距 ($\\Delta y$)',
                'graph.title': '強度分佈',
                'explanation.text': '公式',
                'explanation.question': '試回答問題 (a)(i)：如何增加 $\\Delta y$？',
                'button.explain': '解釋此概念',
                'data.title': '結果',
                'ai.title': 'AI 物理導師'
            },
            cn: {
                'nav.back': '返回首页',
                'title': '杨氏双缝实验',
                'controls.title': '参数设置',
                'controls.wavelength': '波长 ($\\lambda$)',
                'controls.slit': '狭缝间距 ($a$)',
                'controls.distance': '屏幕距离 ($D$)',
                'pattern.title': '干涉图样',
                'pattern.fringe': '条纹间距 ($\\Delta y$)',
                'graph.title': '强度分布',
                'explanation.text': '公式',
                'explanation.question': '试回答问题 (a)(i)：如何增加 $\\Delta y$？',
                'button.explain': '解释此概念',
                'data.title': '结果',
                'ai.title': 'AI 物理导师'
            }
        };

        function setLanguage(lang) {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            if (window.MathJax) MathJax.typesetPromise();
        }
    </script>
</body>
</html>
